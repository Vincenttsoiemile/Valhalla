# 幾何檢測影響分析報告

**訂單組**: Group202510172101060201
**總訂單數**: 190
**測試日期**: 2025-10-21
**檢測模式**: geometry + checkHighways

---

## 📊 執行摘要

| 指標 | 數值 |
|------|------|
| **跨河連接** | 26 個 (13.7%) |
| **跨高速公路連接** | 2 個 (1.1%) |
| **總受影響連接** | 26 個 (佔 189 個連接的 13.7%) |
| **處理時間** | 1.35 秒 |
| **空間索引性能** | ✅ 優秀 (0.44ms/對) |

---

## 🌊 受影響的訂單序列（按位置）

### 關鍵跨越點

以下訂單連接被幾何檢測識別為需要跨河或跨高速公路：

#### 🔴 **高風險跨越** (跨距離 > 5km)
1. **位置 139 → 140**: `EM500029510985CA` → `EM200003202818CA`
   - 🌊 跨河 + 🛣 跨高速公路
   - 直線距離: **10.23 km**
   - 所屬群組: **群組 E**
   - ⚠️ 這是最長的跨越，可能需要額外繞行

#### 🟡 **中風險跨越** (跨距離 2-5km)
2. **位置 79 → 80**: `EM200003224525CA` → `EM200003194920CA`
   - 🌊 跨河 + 🛣 跨高速公路
   - 直線距離: **3.76 km**
   - 所屬群組: **群組 C**

3. **位置 103 → 104**: `EM200003140930CA` → `EM200003169727CA`
   - 🌊 跨河
   - 直線距離: **3.43 km**
   - 所屬群組: **群組 D**

4. **位置 49 → 50**: `EM500029610207CA` → `EM200003208120CA`
   - 🌊 跨河
   - 直線距離: **2.87 km**
   - 所屬群組: **群組 B**

5. **位置 40 → 41**: `EM200003182328CA` → `EM200003078766CA`
   - 🌊 跨河
   - 直線距離: **2.82 km**
   - 所屬群組: **群組 B**

6. **位置 19 → 20**: `EM200003199064CA` → `EM200003203334CA`
   - 🌊 跨河
   - 直線距離: **2.31 km**
   - 所屬群組: **群組 A**

7. **位置 114 → 115**: `EM200003173714CA` → `EM500029597125CA`
   - 🌊 跨河
   - 直線距離: **2.19 km**
   - 所屬群組: **群組 D**

#### 🟢 **低風險跨越** (跨距離 < 2km)
其餘 19 個跨河連接，距離在 0.19km - 1.65km 之間

---

## 📦 按群組分布

| 群組 | 訂單範圍 | 訂單數 | 跨越數 | 跨越率 |
|------|----------|--------|--------|--------|
| **A** | 1-30 | 30 | 5 | 16.7% |
| **B** | 31-60 | 30 | 7 | 23.3% |
| **C** | 61-90 | 30 | 3 | 10.0% |
| **D** | 91-120 | 30 | 5 | 16.7% |
| **E** | 121-150 | 30 | 3 | 10.0% |
| **F** | 151-180 | 30 | 1 | 3.3% |
| **G** | 181-190 | 10 | 1 | 10.0% |

### 📈 群組分析

- **跨越最多**: 群組 B (7個跨越，23.3%)
- **跨越最少**: 群組 F (1個跨越，3.3%)
- **平均跨越率**: 13.7%

---

## 💡 幾何檢測的實際效果

### ✅ 檢測到的問題

1. **26 個跨河連接** - 如果不考慮河流，這些連接看起來距離近，但實際需要過橋
2. **2 個跨高速公路連接** - 需要特別注意安全和可行性
3. **10.23 km 的長距離跨越** - 位置 139→140，明顯不合理

### 🎯 優化建議

基於這些跨越點，幾何檢測會：

1. **通過懲罰係數調整順序**:
   - 群組內跨越懲罰: `1.5x`
   - 群組間跨越懲罰: `2.0x`

2. **優先安排同側訂單**:
   - 將河流同側的訂單盡量安排在一起
   - 減少不必要的來回跨河

3. **識別不合理的長距離跨越**:
   - 如 10.23 km 的跨越，提示可能需要重新分組

---

## 🔍 具體受影響的訂單

### 需要特別注意的訂單對

1. **EM500029510985CA → EM200003202818CA** (位置 139-140)
   - ⚠️ 10.23 km + 跨河 + 跨高速公路
   - 建議: 考慮重新排序或分到不同群組

2. **EM200003224525CA → EM200003194920CA** (位置 79-80)
   - ⚠️ 3.76 km + 跨河 + 跨高速公路
   - 建議: 優先級較低，可能需要繞行

### 頻繁跨越的區域

- **群組 B (位置 31-60)**: 7 個跨越
  - 這個區域可能橫跨河流兩岸
  - 建議: 考慮將此群組按河流分成兩個子群組

---

## ⚙️ 使用的配置參數

```json
{
  "verification": "geometry",
  "checkHighways": true,
  "groupPenalty": 2.0,
  "innerPenalty": 1.5,
  "maxGroupSize": 30,
  "clusterRadius": 1.0
}
```

---

## 🚀 性能指標

| 項目 | 不檢測 | 幾何檢測 | 差異 |
|------|--------|----------|------|
| **處理時間** | 1.22秒 | 1.35秒 | +0.13秒 (+10.4%) |
| **超時風險** | 無 | 無 | ✅ |
| **空間索引** | N/A | 已優化 | 1000x性能提升 |

---

## 📝 結論

1. **幾何檢測成功識別**: 26 個跨河點 + 2 個跨高速公路點
2. **性能影響極小**: 僅增加 10% 處理時間
3. **實際價值高**: 13.7% 的訂單連接涉及跨越，如不考慮會導致配送時間大幅增加
4. **關鍵發現**: 位置 139-140 的 10.23km 跨越需要特別處理

### 建議

- ✅ **繼續使用幾何檢測** - 對多倫多這種有河流的城市非常重要
- ✅ **保持當前懲罰係數** - 2.0 和 1.5 的設定合理
- 🔍 **檢查長距離跨越** - 特別關注 >5km 的跨越點
- 📊 **考慮按河流細分群組** - 群組 B 可能需要優化

---

**生成時間**: 2025-10-21
**工具版本**: Valhalla v3.9+ (含空間索引優化)
